{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Admin-mode usability: actionable in-app error states with raw details + admin authorization guidance",
  "requirements": [
    {
      "id": "REQ-26",
      "summary": "Ensure admin dashboard shows a clear in-app error card with human-friendly English text, raw error details, and a one-click Retry when admin data loads/actions fail.",
      "acceptanceCriteria": [
        "When the admin dashboard fails to load data (stats/users), the page renders an error card (not a blank screen) with an English explanation and a visible raw error detail string.",
        "The error UI includes a one-click Retry action that re-runs the failing fetches.",
        "The raw error detail is readable/copyable (e.g., shown in a code-style block or a dedicated ‘Error details’ section)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/AuthorizationErrorState.tsx",
          "operation": "modify",
          "description": "Extend the existing error UI to always render (1) a human-friendly title/message, (2) a dedicated, readable raw error details section (code-style block) with a copy affordance, and (3) a Retry button when onRetry is provided. Use existing shadcn-ui primitives (Alert/Card/Button) for consistent styling. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/utils/authzErrors.ts",
          "operation": "modify",
          "description": "Enhance error parsing to produce both user-friendly text and a stable rawDetails string for display/copy (e.g., original message, serialized error object). Add lightweight classification helpers so callers can distinguish admin-authorization-required vs generic failure vs other authorization failures. Use guidance from the selected authorization component to handle backend trap/authorization errors gracefully. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/AdminDashboardPage.tsx",
          "operation": "modify",
          "description": "Ensure the admin dashboard error path passes enough context to render a clear error card with Retry that re-runs both failing queries and shows raw error details. Keep the error state visible in-app until navigation/refresh (no console-only failures)."
        }
      ]
    },
    {
      "id": "REQ-28",
      "summary": "When admin password session + Internet Identity are active but admin-only backend calls are rejected, show a dedicated 'Admin authorization required' message that explains what’s missing and how to proceed, explicitly mentioning caffeineAdminToken.",
      "acceptanceCriteria": [
        "In the admin dashboard, if data queries fail due to missing admin authorization, the rendered error state explicitly states that the Internet Identity principal is not authorized as an admin yet and that the app must be opened with the `caffeineAdminToken` parameter.",
        "The error state is displayed inside the app UI (not console-only) and remains visible until the issue is resolved or the user navigates away.",
        "The message uses plain English and does not rely on internal jargon (it should clearly distinguish: admin password session vs Internet Identity vs backend admin authorization)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/utils/authzErrors.ts",
          "operation": "modify",
          "description": "Add explicit detection/mapping for admin-only rejection cases so the UI can show a dedicated 'Admin authorization required' title/message. The message must clearly distinguish: (1) admin password session (local UI gate), (2) Internet Identity sign-in, and (3) backend admin authorization; and must instruct opening the app with the `caffeineAdminToken` URL parameter. Use guidance from the selected authorization component for interpreting authorization failures from backend trap messages. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/AuthorizationErrorState.tsx",
          "operation": "modify",
          "description": "Support rendering the dedicated 'Admin authorization required' state produced by the error parser, while still showing the raw error details section and Retry action. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/AdminDashboardPage.tsx",
          "operation": "modify",
          "description": "When admin dashboard queries fail due to missing backend admin authorization (despite admin session + Internet Identity), render the dedicated 'Admin authorization required' in-app message (including `caffeineAdminToken` instructions) and keep Retry available to re-run the failed fetches after the issue is corrected."
        }
      ]
    }
  ]
}
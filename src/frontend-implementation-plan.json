{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Admin-friendly authorization error states and retry UX",
  "requirements": [
    {
      "id": "REQ-25",
      "summary": "Add clear, actionable UI error states for admin/user pages when backend calls fail due to authorization, without modifying immutable frontend files.",
      "acceptanceCriteria": [
        "On the Admin Dashboard page, if admin data queries fail due to authorization (backend traps / rejects), render a visible in-app message in English indicating that backend admin authorization is missing and that the admin may need to open the app with the `caffeineAdminToken` URL parameter (do not crash or leave the page in a blank/non-updating state).",
        "On the My Audio page and other user tool pages that rely on backend actor calls, if queries/mutations fail due to authorization, show a visible error message in English rather than silently failing (e.g., include the backend error message or a friendly mapped message like \"You do not have permission to perform this action\").",
        "Error states provide a user-actionable next step (e.g., a Retry button that refetches the affected query).",
        "No changes are made to immutable frontend paths (including `frontend/src/hooks/useActor.ts`)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/utils/authzErrors.ts",
          "operation": "create",
          "description": "Create a small error-parsing/mapping utility to detect authorization-related backend failures (e.g., trap/reject messages containing \"Unauthorized\") and return a friendly English title/body plus an optional \"next step\" hint. Use guidance from the selected \"authorization\" component about handling authorization trap errors gracefully. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/AuthorizationErrorState.tsx",
          "operation": "create",
          "description": "Add a reusable presentational component that renders a visible in-app error message (English) and a Retry button callback. Use it across admin/user pages to avoid blank/non-updating states when actor calls are blocked. Use guidance from the selected \"authorization\" component about authorization error handling UX. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/hooks/useAdminData.ts",
          "operation": "modify",
          "description": "Update admin data hooks to be UI-friendly on authorization failures: disable aggressive retries (set retry to false) and ensure errors propagate cleanly so the Admin Dashboard can render an AuthorizationErrorState with a Retry action (refetch)."
        },
        {
          "path": "frontend/src/pages/AdminDashboardPage.tsx",
          "operation": "modify",
          "description": "Handle failed admin queries by rendering an in-app English error state (not a blank table/cards). If the failure is authorization-related, explicitly explain that backend admin authorization appears missing and instruct the admin to open the app with the `caffeineAdminToken` URL parameter, plus provide a Retry button that triggers refetch of stats/users. Use AuthorizationErrorState and authzErrors mapping. Use guidance from the selected \"authorization\" component about gracefully handling backend trap errors. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/hooks/useAudioLibrary.ts",
          "operation": "modify",
          "description": "Adjust audio library query behavior to surface authorization failures predictably (e.g., set retry to false) and ensure consumers can render a visible error + Retry instead of silently failing."
        },
        {
          "path": "frontend/src/pages/MyAudioPage.tsx",
          "operation": "modify",
          "description": "When the audio library query fails (especially authorization-related failures), render a visible in-app English error message (including either the backend message or a friendly mapped permission message) with a Retry button that refetches the audio list. Use AuthorizationErrorState and authzErrors mapping. Use guidance from the selected \"authorization\" component about gracefully handling authorization trap errors. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/MixMasterPage.tsx",
          "operation": "modify",
          "description": "Add visible error handling for failures to load the caller's audio list (authorization or other errors) so the page does not appear non-functional; provide a Retry action to refetch. Reuse AuthorizationErrorState and authzErrors mapping. Use guidance from the selected \"authorization\" component about handling authorization errors gracefully. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/UserDashboardPage.tsx",
          "operation": "modify",
          "description": "Replace the current \"return null\" path when the profile is missing with an explicit, visible English error/empty state when the profile query errored (especially authorization). Provide a Retry button to refetch the profile. Reuse AuthorizationErrorState and authzErrors mapping. Use guidance from the selected \"authorization\" component about handling authorization errors gracefully. Verify the component's usage instructions before implementing."
        }
      ]
    }
  ]
}
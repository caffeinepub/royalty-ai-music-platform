{
  "kind": "build_request",
  "title": "Fix admin-blocking error so the app is fully usable in admin mode",
  "projectName": "ROYALTY AI Music Platform",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-26",
      "text": "Update the admin experience to always show a clear, actionable in-app error state (in English) when an admin action fails, including when the backend returns an authorization/initialization error or “error code”. The UI must display: (1) a human-friendly title/message, (2) the raw error details (so the admin can report the exact code/message), and (3) a Retry action.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages-user-1"
        ],
        "quotes": [
          "And error code is popping up . I just want to be able to use my app fully as admin"
        ]
      },
      "acceptanceCriteria": [
        "When the admin dashboard fails to load data (stats/users), the page renders an error card (not a blank screen) with an English explanation and a visible raw error detail string.",
        "The error UI includes a one-click Retry action that re-runs the failing fetches.",
        "The raw error detail is readable/copyable (e.g., shown in a code-style block or a dedicated ‘Error details’ section)."
      ]
    },
    {
      "id": "REQ-27",
      "text": "Ensure the backend access-control initialization path does not break authenticated usage when the `caffeineAdminToken` secret is missing/empty. Specifically, calling the backend’s access-control initialization with an empty string must not trap or prevent the actor from being created and used for normal authenticated flows.",
      "target": "backend",
      "source": {
        "messageIds": [
          "recent-messages-user-1"
        ],
        "quotes": [
          "And error code is popping up . I just want to be able to use my app fully as admin"
        ]
      },
      "acceptanceCriteria": [
        "If the frontend calls the backend access-control initialization with an empty secret, the call succeeds (no trap) and subsequent authenticated calls (e.g., reading a profile, listing audio) continue to work.",
        "If a valid `caffeineAdminToken` is provided, access-control initialization still works as before (no regression for enabling admin privileges)."
      ]
    },
    {
      "id": "REQ-28",
      "text": "When an admin has an active admin-password session and is signed in with Internet Identity but backend admin-only calls are rejected, show a dedicated ‘Admin authorization required’ error message that explicitly explains what is missing and how to proceed (in English), including mentioning the `caffeineAdminToken` requirement.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages-user-1"
        ],
        "quotes": [
          "I just want to be able to use my app fully as admin"
        ]
      },
      "acceptanceCriteria": [
        "In the admin dashboard, if data queries fail due to missing admin authorization, the rendered error state explicitly states that the Internet Identity principal is not authorized as an admin yet and that the app must be opened with the `caffeineAdminToken` parameter.",
        "The error state is displayed inside the app UI (not console-only) and remains visible until the issue is resolved or the user navigates away.",
        "The message uses plain English and does not rely on internal jargon (it should clearly distinguish: admin password session vs Internet Identity vs backend admin authorization)."
      ]
    }
  ],
  "constraints": [
    "Do not edit files under frontend/src/hooks/useActor.ts (immutable path); implement fixes via backend hardening and/or by composing new frontend code in editable files.",
    "Respect the single-actor Motoko backend architecture (all logic in backend/main.mo).",
    "All user-facing text must be in English."
  ],
  "nonGoals": [
    "Adding third-party authentication providers (only Internet Identity).",
    "Adding external databases or non-Motoko backend services.",
    "Implementing new subscription/payment flows."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}